<?xml version="1.0" encoding="UTF-8"?>
<project name="Jenkins" default="ci" basedir="./">
    <property name="source" value="src" />
    
    <target name="ci" description="Base task" depends="clean,qa"/>

    <target name="clean" description="clean folders">
        <delete dir="${project.basedir}/utils/build/logs" />
        <mkdir dir="${project.basedir}/utils/build/logs" />
    </target>
    
    <target name="qa" description="Launch analyzers">
        <phingcall target="composer" />
        <phingcall target="phpunit" />
    </target>
    
    <target name="composer">
        <exec logoutput="true" dir="${project.basedir}" command="php -r 'copy('https://getcomposer.org/installer', 'composer-setup.php');'" escape="false" />
        <exec logoutput="true" dir="${project.basedir}" command="php -r 'if (hash_file('SHA384', 'composer-setup.php') === 'e115a8dc7871f15d853148a7fbac7da27d6c0030b848d9b3dc09e2a0388afed865e6a3d6b3c0fad45c48e2b5fc1196ae') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;'" escape="false" />
        <exec logoutput="true" dir="${project.basedir}" command="php composer-setup.php" escape="false" />
        <exec logoutput="true" dir="${project.basedir}" command="php -r 'unlink('composer-setup.php');'" escape="false" />
        <exec logoutput="true" dir="${project.basedir}" command="php composer.phar install" escape="false" />
    </target>
    
    <target name="phpunit">
        <exec logoutput="true" dir="${project.basedir}" command="phpunit" escape="false" />
    </target>
</project>
